package com.mcaw.service
import android.app.*; import android.content.*; import android.os.*; import androidx.camera.core.*; import androidx.camera.lifecycle.ProcessCameraProvider; import androidx.core.app.NotificationCompat; import androidx.core.content.ContextCompat; import com.mcaw.R; import java.util.concurrent.Executors; class McawService: Service(){ override fun onBind(p0: Intent?)= null; override fun onCreate(){ super.onCreate(); if(Build.VERSION.SDK_INT>=26){ val nm=getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager; val ch= NotificationChannel("mcaw_fg","MCAW", NotificationManager.IMPORTANCE_LOW); nm.createNotificationChannel(ch) }; val notif= NotificationCompat.Builder(this,"mcaw_fg").setContentTitle("MCAW běží").setSmallIcon(android.R.drawable.stat_sys_warning).build(); startForeground(1, notif); val f= ProcessCameraProvider.getInstance(this); f.addListener({ val p=f.get(); val a= ImageAnalysis.Builder().setBackpressureStrategy(ImageAnalysis.STRATEGY_KEEP_ONLY_LATEST).build(); a.setAnalyzer(Executors.newSingleThreadExecutor()){ it.close() }; p.unbindAll(); p.bindToLifecycle(this, CameraSelector.DEFAULT_BACK_CAMERA, a) }, ContextCompat.getMainExecutor(this)) } }